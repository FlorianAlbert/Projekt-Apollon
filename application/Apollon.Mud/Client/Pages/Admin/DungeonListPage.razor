@page "/admin/dungeons"
@layout AdminLayout

@using Apollon.Mud.Shared.Dungeon
@inject Apollon.Mud.Client.Services.Interfaces.IDungeonService DungeonService
@inject Apollon.Mud.Client.Data.Account.UserContext UserContext

<div class="container ">
    <h1>Liste aller Dungeons</h1>
    @if (allDungeons.Count == 0)
    {
        <h2 class="text-muted">Momentan gibt es keine Dungeons</h2>
    }
    @foreach (DungeonDto dungeon in allDungeons)
    {
        <div class="card mt-2 shadow">
            <h5 class="card-header">@dungeon.DungeonName</h5>
            <div class="card-body">
                <div class="row">
                    <p class="card-text">@dungeon.DungeonDescription</p>
                </div>
            </div>
            <div class="card-footer">Erstellt von @dungeon.DungeonOwner.Email.Split("@")[0]</div>
        </div>
    }
</div>

@code {
    /// <summary>
    /// This list contains all dungeons belonging to the user
    /// </summary>
    private List<DungeonDto> allDungeons = new List<DungeonDto>();


    /// <summary>
    /// When initialized the Method requests all Dungeons belonging to user from the Server and saves them locally
    /// </summary>
    protected async override Task OnInitializedAsync()
    {

        var response = await DungeonService.GetAllDungeons();
        if (!(response is null)) allDungeons = response.ToList();

        StateHasChanged();

    }
}
